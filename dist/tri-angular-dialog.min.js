/*!
 * triAngular Dialog
 */
!function(a){"use strict";a.directive("triDialogMask",["$animate","triDialogConfig","triDialogManager",function(a,b,c){var d=function(d,e,f,g,h){var i=e.parent(),j=null,k=null,l=function(a){a.css("z-index",b.baseZindex+2*c.dialogs.length-1)},m=function(){c.hasAny(g.namespace)?k?l(k):k=h(function(b){a.enter(b,i),l(b),j&&(j.remove(),j=null)}):k&&(a.leave(k,function(){j=null}),j=k,k=null)};d.$on(g.namespace+b.eventCore+b.eventOpen,m),d.$on(g.namespace+b.eventCore+b.eventClosing,m),a.leave(k)};return{link:d,priority:100,require:"^triDialogRoot",restrict:"A",terminal:!0,transclude:"element"}}]),a.directive("triDialogMask",["triDialogManager","triDialogConfig",function(a,b){var c=function(a,c,d,e){c.addClass(e.maskClass+" "+b.maskClass)},d=function(c,d,e,f){d.on("click",function(){var d=a.getUpperDialog();d&&!d.modal&&(f.broadcast(b.eventClose,d),c.$digest())})};return{link:{pre:c,post:d},priority:-100,require:"^triDialogRoot",restrict:"A"}}]),a.directive("triDialogRoot",["$compile","$rootScope","$document","$animate","triDialogConfig","triDialogManager",function(a,b,c,d,e,f){c.on("keydown keypress",function(a){var c;27===a.which&&f.dialogs.length&&(c=f.getUpperDialog(),b.$broadcast(c.namespace+e.eventCore+e.eventClose,c),b.$digest())});var g=function(a,b,c,d){return this.namespace=b.triDialogRoot||c.mainNamespace,d.registerRoot(this),a.$on("$destroy",angular.bind(this,function(){d.unRegisterRoot(this)})),angular.extend(this,{maskClass:this.namespace+"-"+c.maskClass,rootClass:this.namespace+"-"+c.rootClass,broadcast:function(b,d){a.$broadcast(this.namespace+c.eventCore+b,d)},listen:function(b,d){a.$on(this.namespace+c.eventCore+b,d)}})},h=function(b,c,g,h){h.listen(e.eventOpen,function(e,f){var g=angular.element('<section tri:dialog="'+f.label+'"></section>');d.enter(g,c.addClass(h.rootClass)),a(g)(b),!b.$$phase&&b.$digest()}),h.listen(e.eventClosing,function(){!f.hasAny(h.namespace)&&c.removeClass(h.rootClass)})},i=function(a){a.append("<div tri:dialog-mask></div>")};return{controller:["$scope","$attrs","triDialogConfig","triDialogManager",g],link:h,require:"triDialogRoot",restrict:"A",template:i}}]),a.directive("triDialog",["$http","$animate","$compile","$controller","$templateCache","triDialogManager","triDialogConfig","triDialogUtilities",function(a,b,c,d,e,f,g,h){var i=function(h,i,j,k){var l,m=f.dialogs[j.triDialog],n={$dialog:m,$data:m.data,$scope:h},o=function(a){var b=c(a.contents());l&&(a.data("$triDialogController",l),a.children().data("$triDialogController",l)),b(h)};m.controller&&(l=d(m.controller,n),m.controllerAs&&(h[m.controllerAs]=l)),a.get(m.templateUrl,{cache:e}).success(function(a){i.html(a),o(i),h.$emit(g.eventPrefix+g.eventTemplate+g.eventLoaded)}).error(function(){h.$emit(g.eventPrefix+g.eventTemplate+g.eventError)}),h.$emit(g.eventPrefix+g.eventTemplate+g.eventRequested),h.$on(m.namespace+g.eventCore+g.eventClose,function(a,c){c.label==m.label&&(b.leave(i,function(){h.$destroy(),m.destroy(),i=m=null}),f.unRegisterDialog(m.label),k.broadcast(g.eventClosing,c))})},j=function(a,b){var c=f.dialogs[b.triDialog];return a.addClass(g.dialogClass+" "+c.dialogClass).css({zIndex:g.baseZindex+2*(c.label+1),top:h.getTopOffset(c.topOffset)}),i};return{compile:j,require:"^triDialogRoot",restrict:"A",scope:!0}}]),a.constant("triDialogConfig",{baseZindex:3e3,rootClass:"dialog-root",maskClass:"dialog-mask",dialogClass:"dialog",mainNamespace:"main",eventCore:"TriDialog",eventPrefix:"triDialog",eventOpen:"Open",eventClosing:"Closing",eventClose:"Close",eventLoaded:"Loaded",eventError:"Error",eventRequested:"Requested",eventTemplate:"Template"}),a.provider("triDialogManager",["triDialogConfig",function(a){var b=function(a,b){var c=function(){return angular.extend(this,{dialogs:[],roots:{}})};return angular.extend(c.prototype,{hasAny:function(a){return this.dialogs.some(function(b){return b.namespace===a})},getUpperDialog:function(){var a=this.dialogs.length;return a>0&&this.dialogs[a-1]},registerDialog:function(a){return a.label=this.dialogs.push(a)-1,a},unRegisterDialog:function(a){var b=this.dialogs[a];return b&&b.label===a?(this.dialogs.splice(a,1),!0):!1},triggerDialog:function(c){return this.roots.hasOwnProperty(c.namespace)?(this.roots[c.namespace].broadcast(b.eventOpen,this.registerDialog(c)),this):(a.error(new Error("TriDialog: rootCtrl "+c.namespace+" is not registered!")),this)},closeDialog:function(c){return this.roots.hasOwnProperty(c.namespace)?(this.roots[c.namespace].broadcast(b.eventClose,c),this):(a.error(new Error("TriDialog: rootCtrl "+c.namespace+" is not registered!")),this)},registerRoot:function(b){return b.namespace?this.roots.hasOwnProperty(b.namespace)?(a.error(new Error("TriDialog: rootCtrl "+b.namespace+" already registered!")),this):(this.roots[b.namespace]=b,this):(a.error(new Error("TriDialog: rootCtrl has no namespace assigned!")),this)},unRegisterRoot:function(b){return this.roots.hasOwnProperty(b.namespace)?(delete this.roots[b.namespace],this):(a.error(new Error("TriDialog: rootCtrl "+b.namespace+" is not registered!")),this)}}),new c};return{config:function(b){return angular.extend(a,b),this},$get:["$log","triDialogConfig",b]}}]),a.service("triDialogUtilities",[function(){var a=document.body,b=document.documentElement,c=function(){};return angular.extend(c.prototype,{getViewportSize:function(c){return c.isW3C?function(){return{width:window.innerWidth,height:window.innerHeight}}:c.isIE?function(){return{width:b.clientWidth,height:b.clientHeight}}:function(){return{width:a.clientWidth,height:a.clientHeight}}}({isW3C:"undefined"!=typeof window.innerWidth,isIE:"undefined"!=typeof b&&"undefined"!=typeof b.clientWidth&&0!=b.clientWidth}),getTopScroll:function(){return a.scrollTop||b.scrollTop},getTopOffset:function(a){var b=this.getViewportSize().height,c=this.getTopScroll(),d=parseInt(a,10);return angular.isUndefined(a)?c+b/5+"px":isNaN(d)?c+"px":angular.isString(a)&&"%"===a.charAt(a.length-1)?c+b*d/100+"px":c+d+"px"}}),new c}]),a.factory("triDialog",["$log","triDialogConfig","triDialogManager",function(a,b,c){var d=function(c,d){return angular.extend(this,{controller:null,controllerAs:null,dialogClass:"",topOffset:null,modal:!1,namespace:b.mainNamespace,templateUrl:null}),c.templateUrl||a.error(new Error('triNgDialog.DialogData() - initialData must contain defined "templateUrl"')),angular.extend(this,c,{data:d})};return angular.extend(d.prototype,{trigger:function(){return c.triggerDialog(this),this},close:function(){return c.closeDialog(this),this},destroy:function(){var a;for(a in this)this.hasOwnProperty(a)&&delete this[a]}}),function(a,b){return new d(a,b).trigger()}}])}(angular.module("triNgDialog",["ng","ngAnimate"]));
//# sourceMappingURL=tri-angular-dialog.min.js.map