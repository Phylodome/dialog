/*!
 * triAngular Dialog
 */
!function(a){"use strict";a.directive("triDialogMask",["$animate","$rootScope","dialogConfig","dialogManager","dialogUtilities",function(a,b,c,d,e){var f=function(b,c,d,e){return angular.extend(this,{visible:!1,parent:null,update:function(){e.hasAny(this.namespace)?(c.css("z-index",d.baseZindex+2*e.dialogs.length-1),this.visible||(this.visible=!0,a.enter(c,this.parent,this.holder))):this.visible&&(this.visible=!1,a.leave(c))}})},g=function(a,b,d,e){var f=e[0],g=e[1];g.holder=f.holder,g.namespace=f.namespace,g.parent=b.parent(),b.addClass(f.maskClass+" "+c.maskClass)},h=function(a,c,f,g){var h=g[1];b.$on(e.eventLabel(h.namespace,"open"),function(){h.update()}),b.$on(e.eventLabel(h.namespace,"closing"),function(){h.update()}),c.on("click",function(){var a=d.getUpperDialog();a&&!a.modal&&(b.$emit(e.eventLabel(h.namespace,"close"),a),b.$digest())}),c.remove()};return{controller:["$scope","$element","dialogConfig","dialogManager",f],link:{pre:g,post:h},require:["^dialogRoot","triDialogMask"],restrict:"A"}}]),a.directive("dialogRoot",["$compile","$rootScope","$document","$animate","dialogConfig","dialogManager","dialogUtilities",function(a,b,c,d,e,f,g){var h=function(a,b){return this.namespace=a.dialogRoot||b.mainNamespace,angular.extend(this,{holder:null,mask:null,maskClass:this.namespace+"-"+b.maskClass,rootClass:this.namespace+"-"+b.rootClass})},i=function(c,e){var h=angular.element("<!-- triNgDialog for "+e.dialogRoot+" dialog -->"),i=angular.element("<div tri:dialog-mask></div>");return c.append(h),function(c,e,j,k){k.holder=h;var l=function(f,h){d.enter(a(g.getElem(h))(c),e.addClass(k.rootClass),k.holder),!b.$$phase&&b.$digest()},m=function(){!f.hasAny(k.namespace)&&e.removeClass(k.rootClass)};d.enter(i,e,k.holder,function(){a(i)(c)}),b.$on(g.eventLabel(k.namespace,"open"),l),b.$on(g.eventLabel(k.namespace,"closing"),m)}};return{compile:i,controller:["$attrs","dialogConfig",h],require:"dialogRoot",restrict:"A"}}]),a.directive("body",["$rootScope","$document","dialogConfig","dialogManager",function(a,b,c,d){var e=function(){b.on("keydown keypress",function(b){var e=d.getUpperDialog();27===b.which&&e&&(a.$emit((e.namespace||c.mainNamespace)+".dialog.close",e),a.$digest())})};return{restrict:"E",link:e}}]),a.directive("dialog",["$rootScope","$http","$animate","$compile","$controller","$templateCache","dialogManager",function(a,b,c,d,e,f,g){var h=function(h,i,j){var k=g.dialogs[j.dialog],l={$data:k.data,$scope:h},m=function(a){var b;k.controller&&(b=e(k.controller,l),i.data("$ngControllerController",b),i.children().data("$ngControllerController",b),k.controllerAs&&(h[k.controllerAs]=b)),a(h)};b.get(k.templateUrl,{cache:f}).success(function(a){i.html(a),m(d(i.contents())),h.$emit("$triNgDialogTemplateLoaded")}).error(function(){h.$emit("$triNgDialogTemplateError")}),h.$emit("$triNgDialogTemplateRequested"),h.closeClick=function(){a.$emit(k.namespace+".dialog.close",k)},a.$on(k.namespace+".dialog.close",function(b,d){d.label==k.label&&(c.leave(i,function(){h.$destroy()}),g.unRegisterDialog(k.label),a.$emit(k.namespace+".dialog.closing",d))})};return{restrict:"A",link:h,scope:!0}}]),a.constant("dialogConfig",{baseZindex:3e3,rootClass:"dialog-root",maskClass:"dialog-mask",dialogClass:"dialog",mainNamespace:"main"}),a.factory("dialogData",["$log","dialogConfig",function(a,b){var c=function(){return angular.extend(this,{controller:null,controllerAs:null,dialogClass:"",topOffset:null,modal:!1,namespace:b.mainNamespace,templateUrl:null})};return angular.extend(c.prototype,{_updateDialogConfigData:function(b,c){return b.templateUrl||a.error(new Error('triNgDialog.DialogData() - initialData must contain defined "templateUrl"')),angular.extend(this,b,{data:c})}}),function(a,b){return(new c)._updateDialogConfigData(a,b)}}]),a.provider("dialogManager",["dialogConfig",function(a){var b=function(a,b,c){var d=function(){return angular.extend(this,{dialogs:[]})};return angular.extend(d.prototype,{hasAny:function(a){return this.dialogs.some(function(b){return b.namespace===a})},getUpperDialog:function(){var a=this.dialogs.length;return a>0&&this.dialogs[a-1]},registerDialog:function(a){return a.label=this.dialogs.push(a)-1,a},unRegisterDialog:function(a){var b=this.dialogs[a];return b&&b.label===a?(this.dialogs.splice(a,1),!0):!1},triggerDialog:function(d,e){return d=d||{},a.$emit((d.namespace||b.mainNamespace)+".dialog.open",this.registerDialog(c(d,e))),this}}),new d};return{config:function(b){return angular.extend(a,b),this},$get:["$rootScope","dialogConfig","dialogData",b]}}]),a.service("dialogUtilities",["$animate","dialogConfig",function(a,b){var c=document.body,d=document.documentElement,e=function(){};return angular.extend(e.prototype,{getViewportSize:function(a){return a.isW3C?function(){return{width:window.innerWidth,height:window.innerHeight}}:a.isIE?function(){return{width:d.clientWidth,height:d.clientHeight}}:function(){return{width:c.clientWidth,height:c.clientHeight}}}({isW3C:"undefined"!=typeof window.innerWidth,isIE:"undefined"!=typeof d&&"undefined"!=typeof d.clientWidth&&0!=d.clientWidth}),getTopScroll:function(){return c.scrollTop||d.scrollTop},getTopOffset:function(a){var b=this.getViewportSize().height,c=this.getTopScroll(),d=parseInt(a,10);return angular.isUndefined(a)?c+b/5+"px":isNaN(d)?c+"px":angular.isString(a)&&"%"===a.charAt(a.length-1)?c+b*d/100+"px":c+d+"px"},getElem:function(a){return angular.element('<section dialog="'+a.label+'"></section>').addClass(b.dialogClass+" "+a.dialogClass).css({zIndex:b.baseZindex+2*(a.label+1),top:this.getTopOffset(a.topOffset)})},eventLabel:function(a,b){return a+".dialog."+b},extendClass:function(a,b){return a?a+"-"+b:b}}),new e}])}(angular.module("triNgDialog",["ng","ngAnimate"]));
//# sourceMappingURL=tri-angular-dialog.min.js.map